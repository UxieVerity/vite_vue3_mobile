import{e as j,j as A,D as P,aH as E,G as B,b9 as Q,al as W,z as X,T as p,k as u,v as k,h as K,t as Z,q as F,V as C,aJ as $,L as M,w as Y,ae as ee,Q as te,y as ie,W as se,aB as ne,a7 as ae,ar as oe,ai as U,o as _,a as D,a9 as b,ad as I,a8 as V,aj as le,ba as w,F as re,bb as ce,ak as N,aY as de,ab as he,az as fe,aA as ue,ac as G}from"./plugins-libs-4a048428.js";import{u as ge}from"./use-tab-status-bbec0545.js";const[me,x,ve]=j("list"),Te={error:Boolean,offset:k(300),loading:Boolean,disabled:Boolean,finished:Boolean,errorText:String,direction:K("down"),loadingText:String,finishedText:String,immediateCheck:Z};var _e=A({name:me,props:Te,emits:["load","update:error","update:loading"],setup(e,{emit:s,slots:t}){const d=P(e.loading),a=P(),l=P(),g=ge(),n=E(a),c=()=>{F(()=>{if(d.value||e.finished||e.disabled||e.error||(g==null?void 0:g.value)===!1)return;const{direction:o}=e,T=+e.offset,m=C(n);if(!m.height||$(a))return;let y=!1;const R=C(l);o==="up"?y=m.top-R.top<=T:y=R.bottom-m.bottom<=T,y&&(d.value=!0,s("update:loading",!0),s("load"))})},S=()=>{if(e.finished){const o=t.finished?t.finished():e.finishedText;if(o)return u("div",{class:x("finished-text")},[o])}},v=()=>{s("update:error",!1),c()},f=()=>{if(e.error){const o=t.error?t.error():e.errorText;if(o)return u("div",{role:"button",class:x("error-text"),tabindex:0,onClick:v},[o])}},h=()=>{if(d.value&&!e.finished&&!e.disabled)return u("div",{class:x("loading")},[t.loading?t.loading():u(M,{class:x("loading-icon")},{default:()=>[e.loadingText||ve("loading")]})])};return B(()=>[e.loading,e.finished,e.error],c),g&&B(g,o=>{o&&c()}),Q(()=>{d.value=e.loading}),W(()=>{e.immediateCheck&&c()}),X({check:c}),p("scroll",c,{target:n,passive:!0}),()=>{var o;const T=(o=t.default)==null?void 0:o.call(t),m=u("div",{ref:l,class:x("placeholder")},null);return u("div",{ref:a,role:"feed",class:x(),"aria-busy":d.value},[e.direction==="down"?T:m,h(),S(),f(),e.direction==="up"?T:m])}}});const be=Y(_e),[ye,H,xe]=j("pull-refresh"),q=50,Se=["pulling","loosing","success"],Le={disabled:Boolean,modelValue:Boolean,headHeight:k(q),successText:String,pullingText:String,loosingText:String,loadingText:String,pullDistance:ie,successDuration:k(500),animationDuration:k(300)};var we=A({name:ye,props:Le,emits:["change","refresh","update:modelValue"],setup(e,{emit:s,slots:t}){let d;const a=P(),l=P(),g=E(a),n=ee({status:"normal",distance:0,duration:0}),c=te(),S=()=>{if(e.headHeight!==q)return{height:`${e.headHeight}px`}},v=()=>n.status!=="loading"&&n.status!=="success"&&!e.disabled,f=i=>{const r=+(e.pullDistance||e.headHeight);return i>r&&(i<r*2?i=r+(i-r)/2:i=r*1.5+(i-r*2)/4),Math.round(i)},h=(i,r)=>{const L=+(e.pullDistance||e.headHeight);n.distance=i,r?n.status="loading":i===0?n.status="normal":i<L?n.status="pulling":n.status="loosing",s("change",{status:n.status,distance:i})},o=()=>{const{status:i}=n;return i==="normal"?"":e[`${i}Text`]||xe(i)},T=()=>{const{status:i,distance:r}=n;if(t[i])return t[i]({distance:r});const L=[];return Se.includes(i)&&L.push(u("div",{class:H("text")},[o()])),i==="loading"&&L.push(u(M,{class:H("loading")},{default:o})),L},m=()=>{n.status="success",setTimeout(()=>{h(0)},+e.successDuration)},y=i=>{d=ne(g.value)===0,d&&(n.duration=0,c.start(i))},R=i=>{v()&&y(i)},O=i=>{if(v()){d||y(i);const{deltaY:r}=c;c.move(i),d&&r.value>=0&&c.isVertical()&&(se(i),h(f(r.value)))}},z=()=>{d&&c.deltaY.value&&v()&&(n.duration=+e.animationDuration,n.status==="loosing"?(h(+e.headHeight,!0),s("update:modelValue",!0),F(()=>s("refresh"))):h(0))};return B(()=>e.modelValue,i=>{n.duration=+e.animationDuration,i?h(+e.headHeight,!0):t.success||e.successText?m():h(0,!1)}),p("touchmove",O,{target:l}),()=>{var i;const r={transitionDuration:`${n.duration}ms`,transform:n.distance?`translate3d(0,${n.distance}px, 0)`:""};return u("div",{ref:a,class:H()},[u("div",{ref:l,class:H("track"),style:r,onTouchstartPassive:R,onTouchend:z,onTouchcancel:z},[u("div",{class:H("head"),style:S()},[T()]),(i=t.default)==null?void 0:i.call(t)])])}}});const He=Y(we);const Pe={name:"bigList",setup(){const e=oe("PageBody"),s=E(e);return{pagebody:e,scrollParent:s}},inject:["navParams"],props:{items:Array,autoHeight:Boolean,config:{type:Object,default:function(){return{mode:"vant",rowHeight:54,heigthDependencies:[],finishedText:"没有更多了"}}}},computed:{canShowList:function(){return this.showList}},watch:{navParams:{deep:!0,immediate:!0,handler(e,s){this.calculate()}}},data(){return{isready:!1,didx:0,isRefreshing:!1,isLoading:!1,disabledRefresh:!1,count:0,showFooter:!1,isFinished:!1,isVantDoLoading:!1,showList:!1,clientHeight:null}},mounted(){this.addTouchmovePrevent(),this.calculate(),setTimeout(()=>{this.isready=!0},1e3)},activated(){this.scrollTop!=null&&(this.$refs.dyScroller&&(this.$refs.dyScroller.scrollTop=this.scrollTop),this.$refs.vanList&&(this.$refs.vanList.$el.ownerDocument.scrollingElement.scrollTop=this.scrollTop)),this.addTouchmovePrevent()},deactivated(){this.$refs.dyScroller&&(this.scrollTop=this.$refs.dyScroller.scrollTop),this.$refs.vanList&&(this.scrollTop=this.$refs.vanList.$el.ownerDocument.scrollingElement.scrollTop),this.disabledRefresh=!1,this.removeTouchmovePrevent()},beforeUnmount(){this.disabledRefresh=!1,this.removeTouchmovePrevent()},methods:{calculate(){F(()=>{this.autoHeight&&this.scrollParent&&(this.scrollParent.clientHeight!=null?this.clientHeight=this.scrollParent.clientHeight+"px":this.clientHeight=this.pagebody.clientHeight+"px"),this.showList=!0})},removeTouchmovePrevent(){this.flag_touchmovePrevent=!1,document.body.removeEventListener("touchmove",this.touchmovePrevent)},addTouchmovePrevent(){this.flag_touchmovePrevent||(this.flag_touchmovePrevent=!0,document.body.addEventListener("touchmove",this.touchmovePrevent,{passive:!1}))},touchmovePrevent(e){if(this.$refs.pullRefresh){var s=this.$refs.pullRefresh.$el.getElementsByClassName("van-pull-refresh__head"),t=!1;s&&s.length>0&&(t=s[0].children.length>0),console.log("pullRefresh",t),this.isRefreshing||t?e.cancelable&&e.preventDefault():this.config&&this.config.mode=="vant"&&this.isLoading&&e.cancelable&&e.preventDefault()}},traverse(e){const s=e.children;for(let t=0;t<s.length;t++)s[t].scrollTop>40&&console.log("-----","-------"+s[t].className),this.traverse(s[t])},update(e,s,t,d){},onRefresh(){var e=this;this.isLoading=!1,this.$emit("reload",function(s){s&&s.isFinished&&(e.isFinished=!0),e.isRefreshing=!1}),this.isRefreshing=!1},onVantLoad(){this.isRefreshing?this.isLoading=!1:this.isVantDoLoading||(this.isVantDoLoading=!0,this.load())},load(){var e=this;this.$emit("load",function(s){s&&s.isFinished&&(e.isFinished=!0),e.isLoading=!1,e.isVantDoLoading=!1})},scroll(){var e=this.$refs.dyScroller.$el.scrollTop;this.$emit("scroll",e),this.disabledRefresh?e<=0&&(this.disabledRefresh=!1):e>2&&(this.disabledRefresh=!0);var s=this.$refs.dyScroller.$el.scrollHeight-100,t=this.$refs.dyScroller.$el.offsetHeight;s-(e+t)<1?this.showFooter||(this.showFooter=!0,this.isLoading||(this.isLoading=!0,this.load())):this.showFooter&&(this.showFooter=!1)},resize(){},visible(){},hidden(){}}},J=e=>(fe("data-v-6fc44ebd"),e=e(),ue(),e),Re=J(()=>G("div",{style:{width:"100vw","text-align":"center"}},"头部",-1)),De=J(()=>G("div",{style:{width:"100vw","text-align":"center"}},"没有数据",-1)),ke={key:0,style:{width:"100vw","text-align":"center"}},Ve={key:2};function Be(e,s,t,d,a,l){const g=be,n=U("dynamic-scroller-item"),c=U("dynamic-scroller"),S=de,v=He;return _(),D(v,{ref:"pullRefresh",modelValue:a.isRefreshing,"onUpdate:modelValue":s[1]||(s[1]=f=>a.isRefreshing=f),"success-text":"刷新成功",disabled:t.config&&t.config.disabled||a.disabledRefresh,onRefresh:l.onRefresh},{default:b(()=>[t.config&&t.config.mode=="vant"&&l.canShowList?(_(),D(g,{key:0,class:"vanlist",style:I(a.clientHeight!=null?{minHeight:a.clientHeight}:{}),loading:a.isLoading,"onUpdate:loading":s[0]||(s[0]=f=>a.isLoading=f),finished:a.isFinished,"finished-text":t.config&&t.config.finishedText,offset:50,ref:"vanList",direction:"down",onLoad:l.onVantLoad},{default:b(()=>[(_(!0),V(re,null,le(t.items,(f,h)=>w(e.$slots,"cell",{scope:{data:f,index:h}},void 0,!0)),256))]),_:3},8,["style","loading","finished","finished-text","onLoad"])):t.config&&t.config.mode=="scroller"&&l.canShowList?(_(),D(c,{key:1,class:"scroller ignore prevent-sel",style:I(a.clientHeight!=null?{height:a.clientHeight}:{}),items:t.items,"min-item-size":t.config&&t.config.rowHeight>0?t.config.rowHeight:54,emitUpdate:!0,onUpdate:l.update,onResize:l.resize,onVisible:l.visible,onHidden:l.hidden,onScroll:l.scroll,ref:"dyScroller"},ce({before:b(()=>[w(e.$slots,"before",{},()=>[Re],!0)]),default:b(({item:f,index:h,active:o})=>[u(n,{item:f,active:o,"size-dependencies":t.config&&t.config.heigthDependencies?t.config.heigthDependencies:[],"data-index":h,"data-active":o},{default:b(()=>[w(e.$slots,"cell",{scope:{data:f,index:h}},void 0,!0)]),_:2},1032,["item","active","size-dependencies","data-index","data-active"])]),_:2},[!t.items||t.items.length==0?{name:"empty",fn:b(()=>[w(e.$slots,"empty",{},()=>[De],!0)]),key:"0"}:void 0,a.showFooter?{name:"after",fn:b(()=>[w(e.$slots,"after",{},()=>[a.isFinished?(_(),V("div",ke,he(t.config&&t.config.finishedText),1)):N("",!0)],!0)]),key:"1"}:void 0]),1032,["style","items","min-item-size","onUpdate","onResize","onVisible","onHidden","onScroll"])):(_(),V("div",Ve)),a.isready&&l.canShowList&&t.config&&t.config.mode=="scroller"?(_(),D(S,{key:3,class:"big-list-part",target:".vue-recycle-scroller"})):N("",!0)]),_:3},8,["modelValue","disabled","onRefresh"])}const ze=ae(Pe,[["render",Be],["__scopeId","data-v-6fc44ebd"]]);export{ze as B};
