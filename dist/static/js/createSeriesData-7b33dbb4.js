import{d5 as u,b as p,b1 as S,cX as N,cW as C,av as O,ap as E,d6 as R,au as F,d7 as G,l as b}from"./SeriesDataSchema-e01fbb85.js";import{p as k,S as V,g as _}from"./createDimensions-c5d691ce.js";import{e as w,C as B}from"./vendor-0df7ddac.js";var T=function(){function a(e){this.coordSysDims=[],this.axisMap=S(),this.categoryAxisMap=S(),this.coordSysName=e}return a}();function U(a){var e=a.get("coordinateSystem"),t=new T(e),i=j[e];if(i)return i(a,t,t.axisMap,t.categoryAxisMap),t}var j={cartesian2d:function(a,e,t,i){var r=a.getReferringComponents("xAxis",u).models[0],n=a.getReferringComponents("yAxis",u).models[0];e.coordSysDims=["x","y"],t.set("x",r),t.set("y",n),c(r)&&(i.set("x",r),e.firstCategoryDimIndex=0),c(n)&&(i.set("y",n),e.firstCategoryDimIndex==null&&(e.firstCategoryDimIndex=1))},singleAxis:function(a,e,t,i){var r=a.getReferringComponents("singleAxis",u).models[0];e.coordSysDims=["single"],t.set("single",r),c(r)&&(i.set("single",r),e.firstCategoryDimIndex=0)},polar:function(a,e,t,i){var r=a.getReferringComponents("polar",u).models[0],n=r.findAxisModel("radiusAxis"),o=r.findAxisModel("angleAxis");e.coordSysDims=["radius","angle"],t.set("radius",n),t.set("angle",o),c(n)&&(i.set("radius",n),e.firstCategoryDimIndex=0),c(o)&&(i.set("angle",o),e.firstCategoryDimIndex==null&&(e.firstCategoryDimIndex=1))},geo:function(a,e,t,i){e.coordSysDims=["lng","lat"]},parallel:function(a,e,t,i){var r=a.ecModel,n=r.getComponent("parallel",a.get("parallelIndex")),o=e.coordSysDims=n.dimensions.slice();p(n.parallelAxisIndex,function(l,s){var d=r.getComponent("parallelAxis",l),m=o[s];t.set(m,d),c(d)&&(i.set(m,d),e.firstCategoryDimIndex==null&&(e.firstCategoryDimIndex=s))})}};function c(a){return a.get("type")==="category"}function H(a,e){var t=a.get("coordinateSystem"),i=B.get(t),r;return e&&e.coordSysDims&&(r=b(e.coordSysDims,function(n){var o={name:n},l=e.axisMap.get(n);if(l){var s=l.get("type");o.type=_(s)}return o})),r||(r=i&&(i.getDimensionsInfo?i.getDimensionsInfo():i.dimensions.slice())||["x","y"]),r}function L(a,e,t){var i,r;return t&&p(a,function(n,o){var l=n.coordDim,s=t.categoryAxisMap.get(l);s&&(i==null&&(i=o),n.ordinalMeta=s.getOrdinalMeta(),e&&(n.createInvertedIndices=!0)),n.otherDims.itemName!=null&&(r=!0)}),!r&&i!=null&&(a[i].otherDims.itemName=0),i}function K(a,e,t){t=t||{};var i=e.getSourceManager(),r,n=!1;a?(n=!0,r=N(a)):(r=i.getSource(),n=r.sourceFormat===C);var o=U(e),l=H(e,o),s=t.useEncodeDefaulter,d=O(s)?s:s?E(R,l,e):null,m={coordDimensions:l,generateCoord:t.generateCoord,encodeDefine:e.getEncode(),encodeDefaulter:d,canOmitUnusedDimensions:!n},f=k(r,m),D=L(f.dimensions,t.createInvertedIndices,o),y=n?null:i.getSharedDataStore(f),A=w(e,{schema:f,store:y}),g=new V(f,e);g.setCalculationInfo(A);var I=D!=null&&W(r)?function(h,M,v,x){return x===D?v:this.defaultDimValueGetter(h,M,v,x)}:null;return g.hasItemOption=!1,g.initData(n?r:y,null,I),g}function W(a){if(a.sourceFormat===C){var e=X(a.data||[]);return!F(G(e))}}function X(a){for(var e=0;e<a.length&&a[e]==null;)e++;return a[e]}export{K as c};
