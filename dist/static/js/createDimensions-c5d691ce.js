import{b1 as P,b as y,cM as rt,l as at,ar as M,bD as lt,cN as ot,cO as ft,cP as ct,cQ as k,cR as pt,cS as mt,bp as X,au as Y,an as G,aF as dt,M as _t,b0 as vt,cT as Dt,av as B,cU as gt,ao as yt,aw as W,cV as It,ax as $,cW as St,cX as xt,cY as Mt,cZ as Ot,c_ as Et,c$ as wt,a_ as tt,aq as et,d0 as Ct,d1 as Lt,d2 as Nt}from"./SeriesDataSchema-e01fbb85.js";var At=function(){function n(t,e){this._encode=t,this._schema=e}return n.prototype.get=function(){return{fullDimensions:this._getFullDimensionNames(),encode:this._encode}},n.prototype._getFullDimensionNames=function(){return this._cachedDimNames||(this._cachedDimNames=this._schema?this._schema.makeOutputDimensionNames():[]),this._cachedDimNames},n}();function Rt(n,t){var e={},i=e.encode={},r=P(),a=[],o=[],s={};y(n.dimensions,function(c){var f=n.getDimensionInfo(c),v=f.coordDim;if(v){var S=f.coordDimIndex;q(i,v)[S]=c,f.isExtraCoord||(r.set(v,1),Vt(f.type)&&(a[0]=c),q(s,v)[S]=n.getDimensionIndex(f.name)),f.defaultTooltip&&o.push(c)}rt.each(function(L,N){var w=q(i,N),A=f.otherDims[N];A!=null&&A!==!1&&(w[A]=f.name)})});var u=[],D={};r.each(function(c,f){var v=i[f];D[f]=v[0],u=u.concat(v)}),e.dataDimsOnCoord=u,e.dataDimIndicesOnCoord=at(u,function(c){return n.getDimensionInfo(c).storeDimIndex}),e.encodeFirstDimNotExtra=D;var l=i.label;l&&l.length&&(a=l.slice());var m=i.tooltip;return m&&m.length?o=m.slice():o.length||(o=a.slice()),i.defaultedLabel=a,i.defaultedTooltip=o,e.userOutput=new At(s,t),e}function q(n,t){return n.hasOwnProperty(t)||(n[t]=[]),n[t]}function Xt(n){return n==="category"?"ordinal":n==="time"?"time":"float"}function Vt(n){return!(n==="ordinal"||n==="time")}var Ft=function(){function n(t){this.otherDims={},t!=null&&M(this,t)}return n}();const b=Ft;var V=W,E=at,Tt=typeof Int32Array>"u"?Array:Int32Array,Pt="e\0\0",it=-1,Ut=["hasItemOption","_nameList","_idList","_invertedIndicesMap","_dimSummary","userOutput","_rawData","_dimValueGetter","_nameDimIdx","_idDimIdx","_nameRepeatCount"],Gt=["_approximateExtent"],nt,z,F,T,K,H,Z,Bt=function(){function n(t,e){this.type="list",this._dimOmitted=!1,this._nameList=[],this._idList=[],this._visual={},this._layout={},this._itemVisuals=[],this._itemLayouts=[],this._graphicEls=[],this._approximateExtent={},this._calculationInfo={},this.hasItemOption=!1,this.TRANSFERABLE_METHODS=["cloneShallow","downSample","lttbDownSample","map"],this.CHANGABLE_METHODS=["filterSelf","selectRange"],this.DOWNSAMPLE_METHODS=["downSample","lttbDownSample"];var i,r=!1;It(t)?(i=t.dimensions,this._dimOmitted=t.isDimensionOmitted(),this._schema=t):(r=!0,i=t),i=i||["x","y"];for(var a={},o=[],s={},u=!1,D={},l=0;l<i.length;l++){var m=i[l],c=$(m)?new b({name:m}):m instanceof b?m:new b(m),f=c.name;c.type=c.type||"float",c.coordDim||(c.coordDim=f,c.coordDimIndex=0);var v=c.otherDims=c.otherDims||{};o.push(f),a[f]=c,D[f]!=null&&(u=!0),c.createInvertedIndices&&(s[f]=[]),v.itemName===0&&(this._nameDimIdx=l),v.itemId===0&&(this._idDimIdx=l),r&&(c.storeDimIndex=l)}if(this.dimensions=o,this._dimInfos=a,this._initGetDimensionInfo(u),this.hostModel=e,this._invertedIndicesMap=s,this._dimOmitted){var S=this._dimIdxToName=P();y(o,function(L){S.set(a[L].storeDimIndex,L)})}}return n.prototype.getDimension=function(t){var e=this._recognizeDimIndex(t);if(e==null)return t;if(e=t,!this._dimOmitted)return this.dimensions[e];var i=this._dimIdxToName.get(e);if(i!=null)return i;var r=this._schema.getSourceDimension(e);if(r)return r.name},n.prototype.getDimensionIndex=function(t){var e=this._recognizeDimIndex(t);if(e!=null)return e;if(t==null)return-1;var i=this._getDimInfo(t);return i?i.storeDimIndex:this._dimOmitted?this._schema.getSourceDimensionIndex(t):-1},n.prototype._recognizeDimIndex=function(t){if(lt(t)||t!=null&&!isNaN(t)&&!this._getDimInfo(t)&&(!this._dimOmitted||this._schema.getSourceDimensionIndex(t)<0))return+t},n.prototype._getStoreDimIndex=function(t){var e=this.getDimensionIndex(t);return e},n.prototype.getDimensionInfo=function(t){return this._getDimInfo(this.getDimension(t))},n.prototype._initGetDimensionInfo=function(t){var e=this._dimInfos;this._getDimInfo=t?function(i){return e.hasOwnProperty(i)?e[i]:void 0}:function(i){return e[i]}},n.prototype.getDimensionsOnCoord=function(){return this._dimSummary.dataDimsOnCoord.slice()},n.prototype.mapDimension=function(t,e){var i=this._dimSummary;if(e==null)return i.encodeFirstDimNotExtra[t];var r=i.encode[t];return r?r[e]:null},n.prototype.mapDimensionsAll=function(t){var e=this._dimSummary,i=e.encode[t];return(i||[]).slice()},n.prototype.getStore=function(){return this._store},n.prototype.initData=function(t,e,i){var r=this,a;if(t instanceof k&&(a=t),!a){var o=this.dimensions,s=ot(t)||ft(t)?new ct(t,o.length):t;a=new k;var u=E(o,function(D){return{type:r._dimInfos[D].type,property:D}});a.initData(s,u,i)}this._store=a,this._nameList=(e||[]).slice(),this._idList=[],this._nameRepeatCount={},this._doInit(0,a.count()),this._dimSummary=Rt(this,this._schema),this.userOutput=this._dimSummary.userOutput},n.prototype.appendData=function(t){var e=this._store.appendData(t);this._doInit(e[0],e[1])},n.prototype.appendValues=function(t,e){var i=this._store.appendValues(t,e.length),r=i.start,a=i.end,o=this._shouldMakeIdFromName();if(this._updateOrdinalMeta(),e)for(var s=r;s<a;s++){var u=s-r;this._nameList[s]=e[u],o&&Z(this,s)}},n.prototype._updateOrdinalMeta=function(){for(var t=this._store,e=this.dimensions,i=0;i<e.length;i++){var r=this._dimInfos[e[i]];r.ordinalMeta&&t.collectOrdinalMeta(r.storeDimIndex,r.ordinalMeta)}},n.prototype._shouldMakeIdFromName=function(){var t=this._store.getProvider();return this._idDimIdx==null&&t.getSource().sourceFormat!==pt&&!t.fillStorage},n.prototype._doInit=function(t,e){if(!(t>=e)){var i=this._store,r=i.getProvider();this._updateOrdinalMeta();var a=this._nameList,o=this._idList,s=r.getSource().sourceFormat,u=s===St;if(u&&!r.pure)for(var D=[],l=t;l<e;l++){var m=r.getItem(l,D);if(!this.hasItemOption&&mt(m)&&(this.hasItemOption=!0),m){var c=m.name;a[l]==null&&c!=null&&(a[l]=X(c,null));var f=m.id;o[l]==null&&f!=null&&(o[l]=X(f,null))}}if(this._shouldMakeIdFromName())for(var l=t;l<e;l++)Z(this,l);nt(this)}},n.prototype.getApproximateExtent=function(t){return this._approximateExtent[t]||this._store.getDataExtent(this._getStoreDimIndex(t))},n.prototype.setApproximateExtent=function(t,e){e=this.getDimension(e),this._approximateExtent[e]=t.slice()},n.prototype.getCalculationInfo=function(t){return this._calculationInfo[t]},n.prototype.setCalculationInfo=function(t,e){V(t)?M(this._calculationInfo,t):this._calculationInfo[t]=e},n.prototype.getName=function(t){var e=this.getRawIndex(t),i=this._nameList[e];return i==null&&this._nameDimIdx!=null&&(i=F(this,this._nameDimIdx,e)),i==null&&(i=""),i},n.prototype._getCategory=function(t,e){var i=this._store.get(t,e),r=this._store.getOrdinalMeta(t);return r?r.categories[i]:i},n.prototype.getId=function(t){return z(this,this.getRawIndex(t))},n.prototype.count=function(){return this._store.count()},n.prototype.get=function(t,e){var i=this._store,r=this._dimInfos[t];if(r)return i.get(r.storeDimIndex,e)},n.prototype.getByRawIndex=function(t,e){var i=this._store,r=this._dimInfos[t];if(r)return i.getByRawIndex(r.storeDimIndex,e)},n.prototype.getIndices=function(){return this._store.getIndices()},n.prototype.getDataExtent=function(t){return this._store.getDataExtent(this._getStoreDimIndex(t))},n.prototype.getSum=function(t){return this._store.getSum(this._getStoreDimIndex(t))},n.prototype.getMedian=function(t){return this._store.getMedian(this._getStoreDimIndex(t))},n.prototype.getValues=function(t,e){var i=this,r=this._store;return Y(t)?r.getValues(E(t,function(a){return i._getStoreDimIndex(a)}),e):r.getValues(t)},n.prototype.hasValue=function(t){for(var e=this._dimSummary.dataDimIndicesOnCoord,i=0,r=e.length;i<r;i++)if(isNaN(this._store.get(e[i],t)))return!1;return!0},n.prototype.indexOfName=function(t){for(var e=0,i=this._store.count();e<i;e++)if(this.getName(e)===t)return e;return-1},n.prototype.getRawIndex=function(t){return this._store.getRawIndex(t)},n.prototype.indexOfRawIndex=function(t){return this._store.indexOfRawIndex(t)},n.prototype.rawIndexOf=function(t,e){var i=t&&this._invertedIndicesMap[t],r=i[e];return r==null||isNaN(r)?it:r},n.prototype.indicesOfNearest=function(t,e,i){return this._store.indicesOfNearest(this._getStoreDimIndex(t),e,i)},n.prototype.each=function(t,e,i){B(t)&&(i=e,e=t,t=[]);var r=i||this,a=E(T(t),this._getStoreDimIndex,this);this._store.each(a,r?G(e,r):e)},n.prototype.filterSelf=function(t,e,i){B(t)&&(i=e,e=t,t=[]);var r=i||this,a=E(T(t),this._getStoreDimIndex,this);return this._store=this._store.filter(a,r?G(e,r):e),this},n.prototype.selectRange=function(t){var e=this,i={},r=dt(t);return y(r,function(a){var o=e._getStoreDimIndex(a);i[o]=t[a]}),this._store=this._store.selectRange(i),this},n.prototype.mapArray=function(t,e,i){B(t)&&(i=e,e=t,t=[]),i=i||this;var r=[];return this.each(t,function(){r.push(e&&e.apply(this,arguments))},i),r},n.prototype.map=function(t,e,i,r){var a=i||r||this,o=E(T(t),this._getStoreDimIndex,this),s=H(this);return s._store=this._store.map(o,a?G(e,a):e),s},n.prototype.modify=function(t,e,i,r){var a=i||r||this,o=E(T(t),this._getStoreDimIndex,this);this._store.modify(o,a?G(e,a):e)},n.prototype.downSample=function(t,e,i,r){var a=H(this);return a._store=this._store.downSample(this._getStoreDimIndex(t),e,i,r),a},n.prototype.lttbDownSample=function(t,e){var i=H(this);return i._store=this._store.lttbDownSample(this._getStoreDimIndex(t),e),i},n.prototype.getRawDataItem=function(t){return this._store.getRawDataItem(t)},n.prototype.getItemModel=function(t){var e=this.hostModel,i=this.getRawDataItem(t);return new _t(i,e,e&&e.ecModel)},n.prototype.diff=function(t){var e=this;return new vt(t?t.getStore().getIndices():[],this.getStore().getIndices(),function(i){return z(t,i)},function(i){return z(e,i)})},n.prototype.getVisual=function(t){var e=this._visual;return e&&e[t]},n.prototype.setVisual=function(t,e){this._visual=this._visual||{},V(t)?M(this._visual,t):this._visual[t]=e},n.prototype.getItemVisual=function(t,e){var i=this._itemVisuals[t],r=i&&i[e];return r??this.getVisual(e)},n.prototype.hasItemVisual=function(){return this._itemVisuals.length>0},n.prototype.ensureUniqueItemVisual=function(t,e){var i=this._itemVisuals,r=i[t];r||(r=i[t]={});var a=r[e];return a==null&&(a=this.getVisual(e),Y(a)?a=a.slice():V(a)&&(a=M({},a)),r[e]=a),a},n.prototype.setItemVisual=function(t,e,i){var r=this._itemVisuals[t]||{};this._itemVisuals[t]=r,V(e)?M(r,e):r[e]=i},n.prototype.clearAllVisual=function(){this._visual={},this._itemVisuals=[]},n.prototype.setLayout=function(t,e){V(t)?M(this._layout,t):this._layout[t]=e},n.prototype.getLayout=function(t){return this._layout[t]},n.prototype.getItemLayout=function(t){return this._itemLayouts[t]},n.prototype.setItemLayout=function(t,e,i){this._itemLayouts[t]=i?M(this._itemLayouts[t]||{},e):e},n.prototype.clearItemLayouts=function(){this._itemLayouts.length=0},n.prototype.setItemGraphicEl=function(t,e){var i=this.hostModel&&this.hostModel.seriesIndex;Dt(i,this.dataType,t,e),this._graphicEls[t]=e},n.prototype.getItemGraphicEl=function(t){return this._graphicEls[t]},n.prototype.eachItemGraphicEl=function(t,e){y(this._graphicEls,function(i,r){i&&t&&t.call(e,i,r)})},n.prototype.cloneShallow=function(t){return t||(t=new n(this._schema?this._schema:E(this.dimensions,this._getDimInfo,this),this.hostModel)),K(t,this),t._store=this._store,t},n.prototype.wrapMethod=function(t,e){var i=this[t];B(i)&&(this.__wrappedMethods=this.__wrappedMethods||[],this.__wrappedMethods.push(t),this[t]=function(){var r=i.apply(this,arguments);return e.apply(this,[r].concat(gt(arguments)))})},n.internalField=function(){nt=function(t){var e=t._invertedIndicesMap;y(e,function(i,r){var a=t._dimInfos[r],o=a.ordinalMeta,s=t._store;if(o){i=e[r]=new Tt(o.categories.length);for(var u=0;u<i.length;u++)i[u]=it;for(var u=0;u<s.count();u++)i[s.get(a.storeDimIndex,u)]=u}})},F=function(t,e,i){return X(t._getCategory(e,i),null)},z=function(t,e){var i=t._idList[e];return i==null&&t._idDimIdx!=null&&(i=F(t,t._idDimIdx,e)),i==null&&(i=Pt+e),i},T=function(t){return Y(t)||(t=t!=null?[t]:[]),t},H=function(t){var e=new n(t._schema?t._schema:E(t.dimensions,t._getDimInfo,t),t.hostModel);return K(e,t),e},K=function(t,e){y(Ut.concat(e.__wrappedMethods||[]),function(i){e.hasOwnProperty(i)&&(t[i]=e[i])}),t.__wrappedMethods=e.__wrappedMethods,y(Gt,function(i){t[i]=yt(e[i])}),t._calculationInfo=M({},e._calculationInfo)},Z=function(t,e){var i=t._nameList,r=t._idList,a=t._nameDimIdx,o=t._idDimIdx,s=i[e],u=r[e];if(s==null&&a!=null&&(i[e]=s=F(t,a,e)),u==null&&o!=null&&(r[e]=u=F(t,o,e)),u==null&&s!=null){var D=t._nameRepeatCount,l=D[s]=(D[s]||0)+1;u=s,l>1&&(u+="__ec__"+l),r[e]=u}}}(),n}();const Yt=Bt;function qt(n,t){return zt(n,t).dimensions}function zt(n,t){ot(n)||(n=xt(n)),t=t||{};var e=t.coordDimensions||[],i=t.dimensionsDefine||n.dimensionsDefine||[],r=P(),a=[],o=$t(n,e,i,t.dimensionsCount),s=t.canOmitUnusedDimensions&&Mt(o),u=i===n.dimensionsDefine,D=u?Ot(n):Et(i),l=t.encodeDefine;!l&&t.encodeDefaulter&&(l=t.encodeDefaulter(n,o));for(var m=P(l),c=new wt(o),f=0;f<c.length;f++)c[f]=-1;function v(p){var d=c[p];if(d<0){var _=i[p],I=W(_)?_:{name:_},h=new b,O=I.name;O!=null&&D.get(O)!=null&&(h.name=h.displayName=O),I.type!=null&&(h.type=I.type),I.displayName!=null&&(h.displayName=I.displayName);var g=a.length;return c[p]=g,h.storeDimIndex=p,a.push(h),h}return a[d]}if(!s)for(var f=0;f<o;f++)v(f);m.each(function(p,d){var _=tt(p).slice();if(_.length===1&&!$(_[0])&&_[0]<0){m.set(d,!1);return}var I=m.set(d,[]);y(_,function(h,O){var g=$(h)?D.get(h):h;g!=null&&g<o&&(I[O]=g,L(v(g),d,O))})});var S=0;y(e,function(p){var d,_,I,h;if($(p))d=p,h={};else{h=p,d=h.name;var O=h.ordinalMeta;h.ordinalMeta=null,h=M({},h),h.ordinalMeta=O,_=h.dimsDef,I=h.otherDims,h.name=h.coordDim=h.coordDimIndex=h.dimsDef=h.otherDims=null}var g=m.get(d);if(g!==!1){if(g=tt(g),!g.length)for(var Q=0;Q<(_&&_.length||1);Q++){for(;S<o&&v(S).coordDim!=null;)S++;S<o&&g.push(S++)}y(g,function(ht,J){var C=v(ht);if(u&&h.type!=null&&(C.type=h.type),L(et(C,h),d,J),C.name==null&&_){var R=_[J];!W(R)&&(R={name:R}),C.name=C.displayName=R.name,C.defaultTooltip=R.defaultTooltip}I&&et(C.otherDims,I)})}});function L(p,d,_){rt.get(d)!=null?p.otherDims[d]=_:(p.coordDim=d,p.coordDimIndex=_,r.set(d,!0))}var N=t.generateCoord,w=t.generateCoordCount,A=w!=null;w=N?w||1:0;var st=N||"value";function j(p){p.name==null&&(p.name=p.coordDim)}if(s)y(a,function(p){j(p)}),a.sort(function(p,d){return p.storeDimIndex-d.storeDimIndex});else for(var U=0;U<o;U++){var x=v(U),ut=x.coordDim;ut==null&&(x.coordDim=bt(st,r,A),x.coordDimIndex=0,(!N||w<=0)&&(x.isExtraCoord=!0),w--),j(x),x.type==null&&(Ct(n,U)===Lt.Must||x.isExtraCoord&&(x.otherDims.itemName!=null||x.otherDims.seriesName!=null))&&(x.type="ordinal")}return Ht(a),new Nt({source:n,dimensions:a,fullDimensionCount:o,dimensionOmitted:s})}function Ht(n){for(var t=P(),e=0;e<n.length;e++){var i=n[e],r=i.name,a=t.get(r)||0;a>0&&(i.name=r+(a-1)),a++,t.set(r,a)}}function $t(n,t,e,i){var r=Math.max(n.dimensionsDetectedCount||1,t.length,e.length,i||0);return y(t,function(a){var o;W(a)&&(o=a.dimsDef)&&(r=Math.max(r,o.length))}),r}function bt(n,t,e){if(e||t.hasKey(n)){for(var i=0;t.hasKey(n+i);)i++;n+=i}return t.set(n,!0),n}export{Yt as S,qt as c,Xt as g,zt as p};
