import{b as W,cL as Z,aG as I,aF as $}from"./SeriesDataSchema-e01fbb85.js";import{i as V,c as K}from"./vendor-0df7ddac.js";var R="\0__throttleOriginMethod",X="\0__throttleRate",Y="\0__throttleType";function j(i,r,t){var a,n=0,e=0,d=null,v,f,u,o;r=r||0;function c(){e=new Date().getTime(),d=null,i.apply(f,u||[])}var s=function(){for(var g=[],h=0;h<arguments.length;h++)g[h]=arguments[h];a=new Date().getTime(),f=this,u=g;var l=o||r,b=o||t;o=null,v=a-(b?n:e)-l,clearTimeout(d),b?d=setTimeout(c,l):v>=0?c():d=setTimeout(c,-v),n=a};return s.clear=function(){d&&(clearTimeout(d),d=null)},s.debounceNextCall=function(g){o=g},s}function da(i,r,t,a){var n=i[r];if(n){var e=n[R]||n,d=n[Y],v=n[X];if(v!==t||d!==a){if(t==null||!a)return i[r]=e;n=i[r]=j(e,t,a==="debounce"),n[R]=e,n[Y]=a,n[X]=t}return n}}function ua(i,r){var t=i[r];t&&t[R]&&(t.clear&&t.clear(),i[r]=t[R])}var aa="__ec_stack_";function F(i){return i.get("stack")||aa+i.seriesIndex}function N(i){return i.dim+i.index}function ta(i,r){var t=[];return r.eachSeriesByType(i,function(a){q(a)&&t.push(a)}),t}function ra(i){var r={};W(i,function(f){var u=f.coordinateSystem,o=u.getBaseAxis();if(!(o.type!=="time"&&o.type!=="value"))for(var c=f.getData(),s=o.dim+"_"+o.index,g=c.getDimensionIndex(c.mapDimension(o.dim)),h=c.getStore(),l=0,b=h.count();l<b;++l){var m=h.get(g,l);r[s]?r[s].push(m):r[s]=[m]}});var t={};for(var a in r)if(r.hasOwnProperty(a)){var n=r[a];if(n){n.sort(function(f,u){return f-u});for(var e=null,d=1;d<n.length;++d){var v=n[d]-n[d-1];v>0&&(e=e===null?v:Math.min(e,v))}t[a]=e}}return t}function ia(i){var r=ra(i),t=[];return W(i,function(a){var n=a.coordinateSystem,e=n.getBaseAxis(),d=e.getExtent(),v;if(e.type==="category")v=e.getBandWidth();else if(e.type==="value"||e.type==="time"){var f=e.dim+"_"+e.index,u=r[f],o=Math.abs(d[1]-d[0]),c=e.scale.getExtent(),s=Math.abs(c[1]-c[0]);v=u?o/s*u:o}else{var g=a.getData();v=Math.abs(d[1]-d[0])/g.count()}var h=I(a.get("barWidth"),v),l=I(a.get("barMaxWidth"),v),b=I(a.get("barMinWidth")||(J(a)?.5:1),v),m=a.get("barGap"),x=a.get("barCategoryGap");t.push({bandWidth:v,barWidth:h,barMaxWidth:l,barMinWidth:b,barGap:m,barCategoryGap:x,axisKey:N(e),stackId:F(a)})}),ea(t)}function ea(i){var r={};W(i,function(a,n){var e=a.axisKey,d=a.bandWidth,v=r[e]||{bandWidth:d,remainedWidth:d,autoWidthCount:0,categoryGap:null,gap:"20%",stacks:{}},f=v.stacks;r[e]=v;var u=a.stackId;f[u]||v.autoWidthCount++,f[u]=f[u]||{width:0,maxWidth:0};var o=a.barWidth;o&&!f[u].width&&(f[u].width=o,o=Math.min(v.remainedWidth,o),v.remainedWidth-=o);var c=a.barMaxWidth;c&&(f[u].maxWidth=c);var s=a.barMinWidth;s&&(f[u].minWidth=s);var g=a.barGap;g!=null&&(v.gap=g);var h=a.barCategoryGap;h!=null&&(v.categoryGap=h)});var t={};return W(r,function(a,n){t[n]={};var e=a.stacks,d=a.bandWidth,v=a.categoryGap;if(v==null){var f=$(e).length;v=Math.max(35-f*4,15)+"%"}var u=I(v,d),o=I(a.gap,1),c=a.remainedWidth,s=a.autoWidthCount,g=(c-u)/(s+(s-1)*o);g=Math.max(g,0),W(e,function(m){var x=m.maxWidth,y=m.minWidth;if(m.width){var p=m.width;x&&(p=Math.min(p,x)),y&&(p=Math.max(p,y)),m.width=p,c-=p+o*p,s--}else{var p=g;x&&x<p&&(p=Math.min(x,c)),y&&y>p&&(p=y),p!==g&&(m.width=p,c-=p+o*p,s--)}}),g=(c-u)/(s+(s-1)*o),g=Math.max(g,0);var h=0,l;W(e,function(m,x){m.width||(m.width=g),l=m,h+=m.width*(1+o)}),l&&(h-=l.width*o);var b=-h/2;W(e,function(m,x){t[n][x]=t[n][x]||{bandWidth:d,offset:b,width:m.width},b+=m.width*(1+o)})}),t}function ca(i,r,t){if(i&&r){var a=i[N(r)];return a!=null&&t!=null?a[F(t)]:a}}function sa(i,r){var t=ta(i,r),a=ia(t);W(t,function(n){var e=n.getData(),d=n.coordinateSystem,v=d.getBaseAxis(),f=F(n),u=a[N(v)][f],o=u.offset,c=u.width;e.setLayout({bandWidth:u.bandWidth,offset:o,size:c})})}function fa(i){return{seriesType:i,plan:Z(),reset:function(r){if(q(r)){var t=r.getData(),a=r.coordinateSystem,n=a.getBaseAxis(),e=a.getOtherAxis(n),d=t.getDimensionIndex(t.mapDimension(e.dim)),v=t.getDimensionIndex(t.mapDimension(n.dim)),f=r.get("showBackground",!0),u=t.mapDimension(e.dim),o=t.getCalculationInfo("stackResultDimension"),c=V(t,u)&&!!t.getCalculationInfo("stackedOnSeries"),s=e.isHorizontal(),g=na(n,e),h=J(r),l=r.get("barMinHeight")||0,b=o&&t.getDimensionIndex(o),m=t.getLayout("size"),x=t.getLayout("offset");return{progress:function(y,p){for(var A=y.count,M=h&&K(A*3),w=h&&f&&K(A*3),U=h&&K(A),B=a.master.getRect(),Q=s?B.width:B.height,D,E=p.getStore(),k=0;(D=y.next())!=null;){var O=E.get(c?b:d,D),_=E.get(v,D),T=g,H=void 0;c&&(H=+O-E.get(d,D));var L=void 0,P=void 0,C=void 0,G=void 0;if(s){var S=a.dataToPoint([O,_]);if(c){var z=a.dataToPoint([H,_]);T=z[0]}L=T,P=S[1]+x,C=S[0]-T,G=m,Math.abs(C)<l&&(C=(C<0?-1:1)*l)}else{var S=a.dataToPoint([_,O]);if(c){var z=a.dataToPoint([_,H]);T=z[1]}L=S[0]+x,P=T,C=m,G=S[1]-T,Math.abs(G)<l&&(G=(G<=0?-1:1)*l)}h?(M[k]=L,M[k+1]=P,M[k+2]=s?C:G,w&&(w[k]=s?B.x:L,w[k+1]=s?P:B.y,w[k+2]=Q),U[D]=D):p.setItemLayout(D,{x:L,y:P,width:C,height:G}),k+=3}h&&p.setLayout({largePoints:M,largeDataIndices:U,largeBackgroundPoints:w,valueAxisHorizontal:s})}}}}}}function q(i){return i.coordinateSystem&&i.coordinateSystem.type==="cartesian2d"}function J(i){return i.pipelineContext&&i.pipelineContext.large}function na(i,r){return r.toGlobalCoord(r.dataToCoord(r.type==="log"?1:0))}export{ua as a,fa as b,da as c,sa as l,ia as m,ta as p,ca as r,j as t};
