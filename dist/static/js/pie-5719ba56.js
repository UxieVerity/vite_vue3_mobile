import{a as Pe,c as xe}from"./labelLayoutHelper-2c911300.js";import{x as Ne,a as Te,au as ne,aG as C,b as H,aV as ue,bD as me,_ as ie,Z as Ie,ar as O,a7 as ae,ad as he,dZ as Ce,e2 as Ee,e1 as Oe,dM as Ve,d$ as ke,V as Re,ea as Be,$ as ye,d_ as Ge,aC as _e,an as fe,ap as be,eb as Fe,ec as Ye,ed as Ue,aB as Xe,aE as $e}from"./SeriesDataSchema-e01fbb85.js";import{l as ze,a as Ze,s as He,g as qe}from"./labelGuideHelper-79b96b9f.js";import{g as q}from"./sectorHelper-08afe2e6.js";import{p as We,S as je}from"./createDimensions-c5d691ce.js";var W=Math.PI*2,de=Math.PI/180;function Se(t,a){return Te(t.getBoxLayoutParams(),{width:a.getWidth(),height:a.getHeight()})}function Ae(t,a){var n=Se(t,a),e=t.get("center"),i=t.get("radius");ne(i)||(i=[0,i]);var s=C(n.width,a.getWidth()),r=C(n.height,a.getHeight()),g=Math.min(s,r),v=C(i[0],g/2),f=C(i[1],g/2),c,p,h=t.coordinateSystem;if(h){var l=h.dataToPoint(e);c=l[0]||0,p=l[1]||0}else ne(e)||(e=[e,e]),c=C(e[0],s)+n.x,p=C(e[1],r)+n.y;return{cx:c,cy:p,r0:v,r:f}}function Je(t,a,n){a.eachSeriesByType(t,function(e){var i=e.getData(),s=i.mapDimension("value"),r=Se(e,n),g=Ae(e,n),v=g.cx,f=g.cy,c=g.r,p=g.r0,h=-e.get("startAngle")*de,l=e.get("minAngle")*de,o=0;i.each(s,function(P){!isNaN(P)&&o++});var u=i.getSum(s),d=Math.PI/(u||o)*2,y=e.get("clockwise"),b=e.get("roseType"),S=e.get("stillShowZeroSum"),x=i.getDataExtent(s);x[0]=0;var A=W,M=0,L=h,m=y?1:-1;if(i.setLayout({viewRect:r,r:c}),i.each(s,function(P,T){var w;if(isNaN(P)){i.setItemLayout(T,{angle:NaN,startAngle:NaN,endAngle:NaN,clockwise:y,cx:v,cy:f,r0:p,r:b?NaN:c});return}b!=="area"?w=u===0&&S?d:P*d:w=W/o,w<l?(w=l,A-=l):M+=P;var N=L+m*w;i.setItemLayout(T,{angle:w,startAngle:L,endAngle:N,clockwise:y,cx:v,cy:f,r0:p,r:b?Ne(P,x,[p,c]):c}),L=N}),A<W&&o)if(A<=.001){var D=W/o;i.each(s,function(P,T){if(!isNaN(P)){var w=i.getItemLayout(T);w.angle=D,w.startAngle=h+m*T*D,w.endAngle=h+m*(T+1)*D}})}else d=A/M,L=h,i.each(s,function(P,T){if(!isNaN(P)){var w=i.getItemLayout(T),N=w.angle===l?l:P*d;w.startAngle=L,w.endAngle=L+m*N,L+=m*N}})})}function Ke(t){return{seriesType:t,reset:function(a,n){var e=n.findComponents({mainType:"legend"});if(!(!e||!e.length)){var i=a.getData();i.filterSelf(function(s){for(var r=i.getName(s),g=0;g<e.length;g++)if(!e[g].isSelected(r))return!1;return!0})}}}}var Qe=Math.PI/180;function pe(t,a,n,e,i,s,r,g,v,f){if(t.length<2)return;function c(u){for(var d=u.rB,y=d*d,b=0;b<u.list.length;b++){var S=u.list[b],x=Math.abs(S.label.y-n),A=e+S.len,M=A*A,L=Math.sqrt((1-Math.abs(x*x/y))*M),m=a+(L+S.len2)*i,D=m-S.label.x,P=S.targetTextWidth-D*i;De(S,P,!0),S.label.x=m}}function p(u){for(var d={list:[],maxY:0},y={list:[],maxY:0},b=0;b<u.length;b++)if(u[b].labelAlignTo==="none"){var S=u[b],x=S.label.y>n?y:d,A=Math.abs(S.label.y-n);if(A>=x.maxY){var M=S.label.x-a-S.len2*i,L=e+S.len,m=Math.abs(M)<L?Math.sqrt(A*A/(1-M*M/L/L)):L;x.rB=m,x.maxY=A}x.list.push(S)}c(d),c(y)}for(var h=t.length,l=0;l<h;l++)if(t[l].position==="outer"&&t[l].labelAlignTo==="labelLine"){var o=t[l].label.x-f;t[l].linePoints[1][0]+=o,t[l].label.x=f}Pe(t,v,v+r)&&p(t)}function et(t,a,n,e,i,s,r,g){for(var v=[],f=[],c=Number.MAX_VALUE,p=-Number.MAX_VALUE,h=0;h<t.length;h++){var l=t[h].label;re(t[h])||(l.x<a?(c=Math.min(c,l.x),v.push(t[h])):(p=Math.max(p,l.x),f.push(t[h])))}for(var h=0;h<t.length;h++){var o=t[h];if(!re(o)&&o.linePoints){if(o.labelStyleWidth!=null)continue;var l=o.label,u=o.linePoints,d=void 0;o.labelAlignTo==="edge"?l.x<a?d=u[2][0]-o.labelDistance-r-o.edgeDistance:d=r+i-o.edgeDistance-u[2][0]-o.labelDistance:o.labelAlignTo==="labelLine"?l.x<a?d=c-r-o.bleedMargin:d=r+i-p-o.bleedMargin:l.x<a?d=l.x-r-o.bleedMargin:d=r+i-l.x-o.bleedMargin,o.targetTextWidth=d,De(o,d)}}pe(f,a,n,e,1,i,s,r,g,p),pe(v,a,n,e,-1,i,s,r,g,c);for(var h=0;h<t.length;h++){var o=t[h];if(!re(o)&&o.linePoints){var l=o.label,u=o.linePoints,y=o.labelAlignTo==="edge",b=l.style.padding,S=b?b[1]+b[3]:0,x=l.style.backgroundColor?0:S,A=o.rect.width+x,M=u[1][0]-u[2][0];y?l.x<a?u[2][0]=r+o.edgeDistance+A+o.labelDistance:u[2][0]=r+i-o.edgeDistance-A-o.labelDistance:(l.x<a?u[2][0]=l.x+o.labelDistance:u[2][0]=l.x-o.labelDistance,u[1][0]=u[2][0]+M),u[1][1]=u[2][1]=l.y}}}function De(t,a,n){if(n===void 0&&(n=!1),t.labelStyleWidth==null){var e=t.label,i=e.style,s=t.rect,r=i.backgroundColor,g=i.padding,v=g?g[1]+g[3]:0,f=i.overflow,c=s.width+(r?0:v);if(a<c||n){var p=s.height;if(f&&f.match("break")){e.setStyle("backgroundColor",null),e.setStyle("width",a-v);var h=e.getBoundingRect();e.setStyle("width",Math.ceil(h.width)),e.setStyle("backgroundColor",r)}else{var l=a-v,o=a<c?l:n?l>t.unconstrainedWidth?null:l:null;e.setStyle("width",o)}var u=e.getBoundingRect();s.width=u.width;var d=(e.style.margin||0)+2.1;s.height=u.height+d,s.y-=(s.height-p)/2}}}function re(t){return t.position==="center"}function tt(t){var a=t.getData(),n=[],e,i,s=!1,r=(t.get("minShowLabelAngle")||0)*Qe,g=a.getLayout("viewRect"),v=a.getLayout("r"),f=g.width,c=g.x,p=g.y,h=g.height;function l(M){M.ignore=!0}function o(M){if(!M.ignore)return!0;for(var L in M.states)if(M.states[L].ignore===!1)return!0;return!1}a.each(function(M){var L=a.getItemGraphicEl(M),m=L.shape,D=L.getTextContent(),P=L.getTextGuideLine(),T=a.getItemModel(M),w=T.getModel("label"),N=w.get("position")||T.get(["emphasis","label","position"]),j=w.get("distanceToLabelLine"),J=w.get("alignTo"),K=C(w.get("edgeDistance"),f),Le=w.get("bleedMargin"),U=T.getModel("labelLine"),B=U.get("length");B=C(B,f);var X=U.get("length2");if(X=C(X,f),Math.abs(m.endAngle-m.startAngle)<r){H(D.states,l),D.ignore=!0,P&&(H(P.states,l),P.ignore=!0);return}if(o(D)){var $=(m.startAngle+m.endAngle)/2,I=Math.cos($),E=Math.sin($),G,z,le,Z;e=m.cx,i=m.cy;var V=N==="inside"||N==="inner";if(N==="center")G=m.cx,z=m.cy,Z="center";else{var Q=(V?(m.r+m.r0)/2*I:m.r*I)+e,ee=(V?(m.r+m.r0)/2*E:m.r*E)+i;if(G=Q+I*3,z=ee+E*3,!V){var se=Q+I*(B+v-m.r),oe=ee+E*(B+v-m.r),ge=se+(I<0?-1:1)*X,ce=oe;J==="edge"?G=I<0?c+K:c+f-K:G=ge+(I<0?-j:j),z=ce,le=[[Q,ee],[se,oe],[ge,ce]]}Z=V?"center":J==="edge"?I>0?"right":"left":I>0?"left":"right"}var _=Math.PI,k=0,F=w.get("rotate");if(me(F))k=F*(_/180);else if(N==="center")k=0;else if(F==="radial"||F===!0){var we=I<0?-$+_:-$;k=we}else if(F==="tangential"&&N!=="outside"&&N!=="outer"){var R=Math.atan2(I,E);R<0&&(R=_*2+R);var Me=E>0;Me&&(R=_+R),k=R-_}if(s=!!k,D.x=G,D.y=z,D.rotation=k,D.setStyle({verticalAlign:"middle"}),V){D.setStyle({align:Z});var te=D.states.select;te&&(te.x+=D.x,te.y+=D.y)}else{var Y=D.getBoundingRect().clone();Y.applyTransform(D.getComputedTransform());var ve=(D.style.margin||0)+2.1;Y.y-=ve/2,Y.height+=ve,n.push({label:D,labelLine:P,position:N,len:B,len2:X,minTurnAngle:U.get("minTurnAngle"),maxSurfaceAngle:U.get("maxSurfaceAngle"),surfaceNormal:new ue(I,E),linePoints:le,textAlign:Z,labelDistance:j,labelAlignTo:J,edgeDistance:K,bleedMargin:Le,rect:Y,unconstrainedWidth:Y.width,labelStyleWidth:D.style.width})}L.setTextConfig({inside:V})}}),!s&&t.get("avoidLabelOverlap")&&et(n,e,i,v,f,h,c,p);for(var u=0;u<n.length;u++){var d=n[u],y=d.label,b=d.labelLine,S=isNaN(y.x)||isNaN(y.y);if(y){y.setStyle({align:d.textAlign}),S&&(H(y.states,l),y.ignore=!0);var x=y.states.select;x&&(x.x+=y.x,x.y+=y.y)}if(b){var A=d.linePoints;S||!A?(H(b.states,l),b.ignore=!0):(ze(A,d.minTurnAngle),Ze(A,d.surfaceNormal,d.maxSurfaceAngle),b.setShape({points:A}),y.__hostTarget.textGuideLineConfig={anchor:new ue(A[0][0],A[0][1])})}}}var at=function(t){ie(a,t);function a(n,e,i){var s=t.call(this)||this;s.z2=2;var r=new Ie;return s.setTextContent(r),s.updateData(n,e,i,!0),s}return a.prototype.updateData=function(n,e,i,s){var r=this,g=n.hostModel,v=n.getItemModel(e),f=v.getModel("emphasis"),c=n.getItemLayout(e),p=O(q(v.getModel("itemStyle"),c,!0),c);if(isNaN(p.startAngle)){r.setShape(p);return}if(s){r.setShape(p);var h=g.getShallow("animationType");g.ecModel.ssr?(ae(r,{scaleX:0,scaleY:0},g,{dataIndex:e,isFrom:!0}),r.originX=p.cx,r.originY=p.cy):h==="scale"?(r.shape.r=c.r0,ae(r,{shape:{r:c.r}},g,e)):i!=null?(r.setShape({startAngle:i,endAngle:i}),ae(r,{shape:{startAngle:c.startAngle,endAngle:c.endAngle}},g,e)):(r.shape.endAngle=c.startAngle,he(r,{shape:{endAngle:c.endAngle}},g,e))}else Ce(r),he(r,{shape:p},g,e);r.useStyle(n.getItemVisual(e,"style")),Ee(r,v);var l=(c.startAngle+c.endAngle)/2,o=g.get("selectedOffset"),u=Math.cos(l)*o,d=Math.sin(l)*o,y=v.getShallow("cursor");y&&r.attr("cursor",y),this._updateLabel(g,n,e),r.ensureState("emphasis").shape=O({r:c.r+(f.get("scale")&&f.get("scaleSize")||0)},q(f.getModel("itemStyle"),c)),O(r.ensureState("select"),{x:u,y:d,shape:q(v.getModel(["select","itemStyle"]),c)}),O(r.ensureState("blur"),{shape:q(v.getModel(["blur","itemStyle"]),c)});var b=r.getTextGuideLine(),S=r.getTextContent();b&&O(b.ensureState("select"),{x:u,y:d}),O(S.ensureState("select"),{x:u,y:d}),Oe(this,f.get("focus"),f.get("blurScope"),f.get("disabled"))},a.prototype._updateLabel=function(n,e,i){var s=this,r=e.getItemModel(i),g=r.getModel("labelLine"),v=e.getItemVisual(i,"style"),f=v&&v.fill,c=v&&v.opacity;Ve(s,ke(r),{labelFetcher:e.hostModel,labelDataIndex:i,inheritColor:f,defaultOpacity:c,defaultText:n.getFormattedLabel(i,"normal")||e.getName(i)});var p=s.getTextContent();s.setTextConfig({position:null,rotation:null}),p.attr({z2:10});var h=n.get(["label","position"]);if(h!=="outside"&&h!=="outer")s.removeTextGuideLine();else{var l=this.getTextGuideLine();l||(l=new Re,this.setTextGuideLine(l)),He(this,qe(r),{stroke:f,opacity:Be(g.get(["lineStyle","opacity"]),c,1)})}},a}(ye),rt=function(t){ie(a,t);function a(){var n=t!==null&&t.apply(this,arguments)||this;return n.ignoreLabelLineUpdate=!0,n}return a.prototype.render=function(n,e,i,s){var r=n.getData(),g=this._data,v=this.group,f;if(!g&&r.count()>0){for(var c=r.getItemLayout(0),p=1;isNaN(c&&c.startAngle)&&p<r.count();++p)c=r.getItemLayout(p);c&&(f=c.startAngle)}if(this._emptyCircleSector&&v.remove(this._emptyCircleSector),r.count()===0&&n.get("showEmptyCircle")){var h=new ye({shape:Ae(n,i)});h.useStyle(n.getModel("emptyCircleStyle").getItemStyle()),this._emptyCircleSector=h,v.add(h)}r.diff(g).add(function(l){var o=new at(r,l,f);r.setItemGraphicEl(l,o),v.add(o)}).update(function(l,o){var u=g.getItemGraphicEl(o);u.updateData(r,l,f),u.off("click"),v.add(u),r.setItemGraphicEl(l,u)}).remove(function(l){var o=g.getItemGraphicEl(l);Ge(o,n,l)}).execute(),tt(n),n.get("animationTypeUpdate")!=="expansion"&&(this._data=r)},a.prototype.dispose=function(){},a.prototype.containPoint=function(n,e){var i=e.getData(),s=i.getItemLayout(0);if(s){var r=n[0]-s.cx,g=n[1]-s.cy,v=Math.sqrt(r*r+g*g);return v<=s.r&&v>=s.r0}},a.type="pie",a}(_e);const nt=rt;function it(t,a,n){a=ne(a)&&{coordDimensions:a}||O({encodeDefine:t.getEncode()},a);var e=t.getSource(),i=We(e,a).dimensions,s=new je(i,t);return s.initData(e,n),s}var lt=function(){function t(a,n){this._getDataWithEncodedVisual=a,this._getRawData=n}return t.prototype.getAllNames=function(){var a=this._getRawData();return a.mapArray(a.getName)},t.prototype.containName=function(a){var n=this._getRawData();return n.indexOfName(a)>=0},t.prototype.indexOfName=function(a){var n=this._getDataWithEncodedVisual();return n.indexOfName(a)},t.prototype.getItemVisual=function(a,n){var e=this._getDataWithEncodedVisual();return e.getItemVisual(a,n)},t}();const st=lt;var ot=$e(),gt=function(t){ie(a,t);function a(){return t!==null&&t.apply(this,arguments)||this}return a.prototype.init=function(n){t.prototype.init.apply(this,arguments),this.legendVisualProvider=new st(fe(this.getData,this),fe(this.getRawData,this)),this._defaultLabelLine(n)},a.prototype.mergeOption=function(){t.prototype.mergeOption.apply(this,arguments)},a.prototype.getInitialData=function(){return it(this,{coordDimensions:["value"],encodeDefaulter:be(Fe,this)})},a.prototype.getDataParams=function(n){var e=this.getData(),i=ot(e),s=i.seats;if(!s){var r=[];e.each(e.mapDimension("value"),function(v){r.push(v)}),s=i.seats=Ye(r,e.hostModel.get("percentPrecision"))}var g=t.prototype.getDataParams.call(this,n);return g.percent=s[n]||0,g.$vars.push("percent"),g},a.prototype._defaultLabelLine=function(n){Ue(n,"labelLine",["show"]);var e=n.labelLine,i=n.emphasis.labelLine;e.show=e.show&&n.label.show,i.show=i.show&&n.emphasis.label.show},a.type="series.pie",a.defaultOption={z:2,legendHoverLink:!0,colorBy:"data",center:["50%","50%"],radius:[0,"75%"],clockwise:!0,startAngle:90,minAngle:0,minShowLabelAngle:0,selectedOffset:10,percentPrecision:2,stillShowZeroSum:!0,left:0,top:0,right:0,bottom:0,width:null,height:null,label:{rotate:0,show:!0,overflow:"truncate",position:"outer",alignTo:"none",edgeDistance:"25%",bleedMargin:10,distanceToLabelLine:5},labelLine:{show:!0,length:15,length2:15,smooth:!1,minTurnAngle:90,maxSurfaceAngle:90,lineStyle:{width:1,type:"solid"}},itemStyle:{borderWidth:1,borderJoin:"round"},showEmptyCircle:!0,emptyCircleStyle:{color:"lightgray",opacity:1},labelLayout:{hideOverlap:!0},emphasis:{scale:!0,scaleSize:5},avoidLabelOverlap:!0,animationType:"expansion",animationDuration:1e3,animationTypeUpdate:"transition",animationEasingUpdate:"cubicInOut",animationDurationUpdate:500,animationEasing:"cubicInOut"},a}(Xe);const ct=gt;function vt(t){return{seriesType:t,reset:function(a,n){var e=a.getData();e.filterSelf(function(i){var s=e.mapDimension("value"),r=e.get(s,i);return!(me(r)&&!isNaN(r)&&r<0)})}}}function ut(t){t.registerChartView(nt),t.registerSeriesModel(ct),xe("pie",t.registerAction),t.registerLayout(be(Je,"pie")),t.registerProcessor(Ke("pie")),t.registerProcessor(vt("pie"))}const yt=function(t){t.use([ut])};export{yt as default};
